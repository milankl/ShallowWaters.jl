<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Introduction · ShallowWaters.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>ShallowWaters.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Introduction</a><ul class="internal"><li><a class="tocitem" href="#How-to-use"><span>How to use</span></a></li><li><a class="tocitem" href="#Double-gyre-example"><span>Double-gyre example</span></a></li><li><a class="tocitem" href="#(Some)-Features"><span>(Some) Features</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li><li><a class="tocitem" href="#The-equations"><span>The equations</span></a></li></ul></li><li><a class="tocitem" href="swm_equations/">Tutorial</a></li><li><a class="tocitem" href="reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Introduction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Introduction</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/milankl/ShallowWaters.jl/blob/main/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ShallowWaters.jl-A-type-flexible-16-bit-shallow-water-model"><a class="docs-heading-anchor" href="#ShallowWaters.jl-A-type-flexible-16-bit-shallow-water-model">ShallowWaters.jl - A type-flexible 16-bit shallow water model</a><a id="ShallowWaters.jl-A-type-flexible-16-bit-shallow-water-model-1"></a><a class="docs-heading-anchor-permalink" href="#ShallowWaters.jl-A-type-flexible-16-bit-shallow-water-model" title="Permalink"></a></h1><p><a href="https://github.com/milankl/ShallowWaters.jl/actions/workflows/CI.yml"><img src="https://github.com/milankl/ShallowWaters.jl/actions/workflows/CI.yml/badge.svg" alt="CI"/></a> <a href="https://zenodo.org/badge/latestdoi/132787050"><img src="https://zenodo.org/badge/132787050.svg" alt="DOI"/></a> <img src="https://github.com/milankl/ShallowWaters.jl/tree/main/figs/isambard_float16.png?raw=true &quot;Float16 simulation with ShallowWaters.jl on Isambard&#39;s A64FX&quot;" alt="sst"/></p><p>A shallow water model with a focus on type-flexibility and 16-bit number formats. ShallowWaters allows for Float64/32/16,  <a href="https://github.com/milankl/SoftPosit.jl">Posit32/16/8</a>, <a href="https://github.com/JuliaComputing/BFloat16s.jl">BFloat16</a>,  <a href="https://github.com/milankl/LogFixPoint16s.jl">LogFixPoint16</a>, <a href="https://github.com/milankl/Sonums.jl">Sonum16</a>,  <a href="https://github.com/milankl/StochasticRounding.jl">Float32/16 &amp; BFloat16 with stochastic rounding</a> and in  general every number format with arithmetics and conversions implemented. ShallowWaters also allows for mixed-precision and reduced precision communication.</p><p>ShallowWaters uses an energy and enstrophy conserving advection scheme and a Smagorinsky-like biharmonic diffusion operator.  Tracer advection is implemented with a semi-Lagrangian advection scheme. Strong stability-preserving Runge-Kutta schemes of various orders and stages are used with a semi-implicit treatment of the continuity equation. Boundary conditions are either  periodic (only in x direction) or non-periodic super-slip, free-slip, partial-slip, or no-slip. Output via <a href="https://github.com/JuliaGeo/NetCDF.jl">NetCDF</a>.</p><p>Please feel free to raise an <a href="https://github.com/milankl/ShallowWaters.jl/issues">issue</a> if you discover bugs or have an idea how to improve ShallowWaters.</p><p>Requires: Julia 1.2 or higher</p><h2 id="How-to-use"><a class="docs-heading-anchor" href="#How-to-use">How to use</a><a id="How-to-use-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-use" title="Permalink"></a></h2><p><code>RunModel</code> initialises the model, preallocates memory and starts the time integration. You find the options and default parameters in <code>src/DefaultParameters.jl</code> (or by typing <code>?Parameter</code>).</p><pre><code class="language-julia hljs">help?&gt; Parameter
search: Parameter

  Creates a Parameter struct with following options and default values

  T::DataType=Float32                 # number format

  Tprog::DataType=T                   # number format for prognostic variables
  Tcomm::DataType=Tprog               # number format for ghost-point copies

  # DOMAIN RESOLUTION AND RATIO
  nx::Int=100                         # number of grid cells in x-direction
  Lx::Real=2000e3                     # length of the domain in x-direction [m]
  L_ratio::Real=2                     # Domain aspect ratio of Lx/Ly
  ...</code></pre><p>They can be changed with keyword arguments. The number format <code>T</code> is defined as the first (but optional) argument of <code>RunModel(T,...)</code></p><pre><code class="language-julia hljs">julia&gt; Prog = run_model(Float32,Ndays=10,g=10,H=500,Fx0=0.12);
Starting ShallowWaters on Sun, 20 Oct 2019 19:58:25 without output.
100% Integration done in 4.65s.</code></pre><p>or by creating a Parameter struct</p><pre><code class="language-julia hljs">julia&gt; P = Parameter(bc=&quot;nonperiodic&quot;,wind_forcing_x=&quot;double_gyre&quot;,L_ratio=1,nx=128);
julia&gt; Prog = run_model(P);</code></pre><p>The number formats can be different (aka mixed-precision) for different parts of the model. <code>Tprog</code> is the number type for the prognostic variables, <code>Tcomm</code> is used for communication of boundary values.</p><h2 id="Double-gyre-example"><a class="docs-heading-anchor" href="#Double-gyre-example">Double-gyre example</a><a id="Double-gyre-example-1"></a><a class="docs-heading-anchor-permalink" href="#Double-gyre-example" title="Permalink"></a></h2><p>You can for example run a double gyre simulation like this</p><pre><code class="language-julia hljs">julia&gt; using ShallowWaters
julia&gt; P = run_model(Ndays=100,nx=100,L_ratio=1,bc=&quot;nonperiodic&quot;,wind_forcing_x=&quot;double_gyre&quot;,topography=&quot;seamount&quot;);
Starting ShallowWaters on Sat, 15 Aug 2020 11:59:21 without output.
100% Integration done in 13.7s.</code></pre><p>Sea surface height can be visualised via</p><pre><code class="language-julia hljs">julia&gt; using PyPlot
julia&gt; pcolormesh(P.η&#39;)</code></pre><p><img src="https://user-images.githubusercontent.com/25530332/90311163-1ee40a00-def0-11ea-8911-810d7762cd3f.png" alt="Figure_1"/></p><p>Or let&#39;s calculate the speed of the currents</p><pre><code class="language-julia hljs">julia&gt; speed = sqrt.(Ix(P.u.^2)[:,2:end-1] + Iy(P.v.^2)[2:end-1,:])</code></pre><p><code>P.u</code> and <code>P.v</code> are the u,v velocity components on the Arakawa C-grid. To add them, we need to interpolate them with <code>Ix,Iy</code> (which are exported by <code>ShallowWaters.jl</code> too), then chopping off the edges to get two arrays of the same size.</p><pre><code class="language-julia hljs">julia&gt; pcolormesh(speed&#39;)</code></pre><p><img src="https://user-images.githubusercontent.com/25530332/90311211-88fcaf00-def0-11ea-8308-b4f438495152.png" alt="Figure_2"/></p><p>Such that the currents are strongest around the two eddies, as expected in this quasi-geostrophic setup.</p><h2 id="(Some)-Features"><a class="docs-heading-anchor" href="#(Some)-Features">(Some) Features</a><a id="(Some)-Features-1"></a><a class="docs-heading-anchor-permalink" href="#(Some)-Features" title="Permalink"></a></h2><ul><li>Interpolation of initial conditions from low resolution / high resolution runs.</li><li>Output of relative vorticity, potential vorticity and tendencies du,dv,deta</li><li>(Pretty accurate) duration estimate</li><li>Can be run in ensemble mode with ordered non-conflicting output files</li><li>Runs at CFL=1 (RK4), and more with the strong stability-preserving Runge-Kutta methods</li><li>Solving the tracer advection comes at basically no cost, thanks to semi-Lagrangian advection scheme</li><li>Also outputs the gradient operators ∂/∂x,∂/∂y and interpolations Ix, Iy for easier post-processing.</li></ul><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>ShallowWaters.jl is a registered package, so simply do</p><pre><code class="language-julia hljs">julia&gt; ] add ShallowWaters</code></pre><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>ShallowWaters.jl was used and is described in more detail in  </p><p>Klöwer M, Düben PD, Palmer TN. Number formats, error mitigation and scope for 16-bit arithmetics in weather and climate modelling analysed with a shallow water model. Journal of Advances in Modeling Earth Systems. doi: <a href="https://dx.doi.org/10.1029/2020MS002246">10.1029/2020MS002246</a></p><p>Klöwer M, Düben PD, Palmer TN. Posits as an alternative to floats for weather and climate models. In: Proceedings of the Conference for Next Generation Arithmetic 2019. doi: <a href="https://dx.doi.org/10.1145/3316279.3316281">10.1145/3316279.3316281</a></p><h2 id="The-equations"><a class="docs-heading-anchor" href="#The-equations">The equations</a><a id="The-equations-1"></a><a class="docs-heading-anchor-permalink" href="#The-equations" title="Permalink"></a></h2><p>The non-linear shallow water model plus tracer equation is</p><pre><code class="nohighlight hljs">      ∂u/∂t + (u⃗⋅∇)u - f*v = -g*∂η/∂x - c_D*|u⃗|*u + ∇⋅ν*∇(∇²u) + Fx(x,y)     (1)
      ∂v/∂t + (u⃗⋅∇)v + f*u = -g*∂η/∂y - c_D*|u⃗|*v + ∇⋅ν*∇(∇²v) + Fy(x,y)     (2)
      ∂η/∂t = -∇⋅(u⃗h) + γ*(η_ref - η) + Fηt(t)*Fη(x,y)                       (3)
      ∂ϕ/∂t = -u⃗⋅∇ϕ                                                          (4)</code></pre><p>with the prognostic variables velocity u⃗ = (u,v) and sea surface heigth η. The layer thickness is h = η + H(x,y). The Coriolis parameter is f = f₀ + βy with beta-plane approximation. The graviational acceleration is g. Bottom friction is either quadratic with drag coefficient c<em>D or linear with inverse time scale r. Diffusion is realized with a biharmonic diffusion operator, with either a constant viscosity coefficient ν, or a Smagorinsky-like coefficient that scales as ν = c</em>Smag*|D|, with deformation rate |D| = √((∂u/∂x - ∂v/∂y)² + (∂u/∂y + ∂v/∂x)²). Wind forcing Fx is constant in time, but may vary in space.</p><p>The linear shallow water model equivalent is</p><pre><code class="nohighlight hljs">      ∂u/∂t - f*v = -g*∂η/∂x - r*u + ∇⋅ν*∇(∇²u) + Fx(x,y)     (1)
      ∂v/∂t + f*u = -g*∂η/∂y - r*v + ∇⋅ν*∇(∇²v) + Fy(x,y)     (2)
      ∂η/∂t = -H*∇⋅u⃗ + γ*(η_ref - η) + Fηt(t)*Fη(x,y)         (3)
      ∂ϕ/∂t = -u⃗⋅∇ϕ                                           (4)</code></pre><p>ShallowWaters.jl discretises the equation on an equi-distant Arakawa C-grid, with 2nd order finite-difference operators. Boundary conditions are implemented via a ghost-point copy and each variable has a halo of variable size to account for different stencil sizes of various operators.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="swm_equations/">Tutorial »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Wednesday 8 May 2024 16:33">Wednesday 8 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
